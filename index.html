<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Metronome</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 2rem; }
    #flash { width: 40px; height: 40px; border-radius: 50%; background: #ccc; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Metronome</h1>
  <label>BPM: <input type="number" id="bpm" value="120" min="30" max="300"></label>
  <div>
    <button id="start">Start</button>
    <button id="stop" disabled>Stop</button>
  </div>
  <div id="flash"></div>

  <script type="module">
    import { TempoAgent } from './agents/TempoAgent.js';
    import { AudioAgent } from './agents/AudioAgent.js';
    import { VisualAgent } from './agents/VisualAgent.js';
    import { InputAgent } from './agents/InputAgent.js';

    const tempoAgent = new TempoAgent({ bpm: 120 });
    const audioAgent = new AudioAgent({});
    const visualAgent = new VisualAgent({
      elementSelector: '#flash',
      beatStyle: { background: 'yellow' },
      subbeatStyle: { background: 'orange' }
    });
    const inputAgent = new InputAgent({
      controlSelectors: {
        bpmSlider: '#bpm',
        startButton: '#start',
        stopButton: '#stop'
      }
    });

    inputAgent.addEventListener('start', () => {
      tempoAgent.start();
      document.getElementById('start').disabled = true;
      document.getElementById('stop').disabled = false;
    });
    inputAgent.addEventListener('stop', () => {
      tempoAgent.stop();
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
    });
    inputAgent.addEventListener('bpmChange', e => tempoAgent.setBpm(e.detail));

    tempoAgent.addEventListener('beat', () => {
      audioAgent.playPrimary();
      visualAgent.flashBeat();
    });
    tempoAgent.addEventListener('subbeat', () => {
      audioAgent.playSubdivision();
      visualAgent.flashSubbeat();
    });
  </script>
</body>
</html>
